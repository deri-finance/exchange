webpackJsonp([7],{gdx1:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n("Xgv0"),a=n("zH3I"),r=n.n(a),s=n("rVsN"),o=n.n(s),c=n("KH7x"),u=n.n(c),l=n("IHPB"),h=n.n(l),d=n("lC5x"),p=n.n(d),f=n("hRKE"),m=n.n(f),v=n("J0Oq"),b=n.n(v),_=n("AA3o"),w=n.n(_),k=n("xSur"),g=n.n(k),y=n("72mw"),x=n.n(y),R=n("zf2T");function C(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return 0==e?Object(R.a)(t):e>0?Object(R.a)(t).times(Object(R.a)("1"+"0".repeat(e))):Object(R.a)(t).div(Object(R.a)("1"+"0".repeat(-e)))}function T(t){return C(t,-18)}R.a.config({DECIMAL_PLACES:18,ROUNDING_MODE:R.a.ROUND_DOWN,EXPONENTIAL_AT:256});var S=function(){function t(){w()(this,t),this.web3=null,this.addresses=null,this.abifiles=null,this.methods=null,this.providerUrl=null,this.pool=null,this.bToken=null,this.account=null,this.symbol=null,this.bSymbol=null,this.multiplier=null,this.feeRatio=null,this.minInitialMarginRatio=null,this.balance={},this.position={volume:C(0),cost:C(0),lastCumuFundingRate:C(0),margin:C(0),lastUpdateTimestamp:C(0)}}return g()(t,[{key:"connectWallet",value:function(){var t=b()(p.a.mark(function t(){return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0==m()(window.ethereum)){t.next=9;break}return this.web3=new x.a(ethereum),this.ethereum=window.ethereum,t.next=5,ethereum.request({method:"eth_requestAccounts"});case 5:return this.account=t.sent[0],t.abrupt("return",{success:!0,account:this.account});case 9:return t.abrupt("return",{success:!1,error:"Cannot connect wallet"});case 10:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"initialize",value:function(){var t=b()(p.a.mark(function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._initializeContracts(e);case 2:return t.next=4,this._initializeParameters();case 4:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"tradeEvent",value:function(){var t=b()(p.a.mark(function t(e){var n,i,a,r,s,o,c,u,l,h,d;return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return console.log(e),n={owner:e},t.next=4,this._getPastEvents(this.pool,"Trade",n);case 4:i=t.sent,a=[],r=0;case 7:if(!(r<i.length)){t.next=21;break}return s=i[r],o=s.returnValues,t.next=12,this._getTimeStamp(s.blockNumber);case 12:c=t.sent,u=T(C(o.tradeVolume)),l=T(C(o.price)),h=u.abs().times(l).times(this.multiplier).times(this.minInitialMarginRatio),d=u.gt(0)?"LONG":"SHORT",a.push({direction:d,baseToken:this.bSymbol,price:T(o.price).toString(),volume:T(o.tradeVolume).toString(),notional:h.toString(),transactionFee:this._calculateFee(u,l),time:+c.timestamp+"000"});case 18:r++,t.next=7;break;case 21:return console.log(a),t.abrupt("return",a);case 23:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"_calculateFee",value:function(t,e){return C(t).abs().times(e).times(this.multiplier).times(this.feeRatio).toString()}},{key:"_getPastEvents",value:function(){var t=b()(p.a.mark(function t(e,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getPastEvents(n,{filter:i,fromBlock:0,toBlock:"latest"},function(t,e){return e});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,this)}));return function(e,n){return t.apply(this,arguments)}}()},{key:"_getTimeStamp",value:function(){var t=b()(p.a.mark(function t(e){return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.web3.eth.getBlock(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"_call",value:function(){var t=b()(p.a.mark(function t(e,n){var i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(i=e.methods)[this.methods[n]].apply(i,h()(a)).call();case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,this)}));return function(e,n){return t.apply(this,arguments)}}()},{key:"_readjson",value:function(){var t=b()(p.a.mark(function t(e){var n;return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("static/config/"+e);case 2:return n=t.sent,t.next=5,n.json();case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"_initializeContracts",value:function(){var t=b()(p.a.mark(function t(e){var n,i,a,r,s,c,l;return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this._readjson("config.json");case 3:return n=t.sent,this.addresses=n.addresses[e],this.abifiles=n.abifiles,this.methods=n.methods,t.next=9,o.a.all([this._readjson(this.abifiles.pool),this._readjson(this.abifiles.bToken),this._readjson(this.abifiles.pToken),this._readjson(this.abifiles.lToken)]);case 9:i=t.sent,a=u()(i,4),r=a[0],s=a[1],c=a[2],l=a[3],this.pool=new this.web3.eth.Contract(r,this.addresses.pool),this.bToken=new this.web3.eth.Contract(s,this.addresses.bToken),this.pToken=new this.web3.eth.Contract(c,this.addresses.pToken),this.lToken=new this.web3.eth.Contract(l,this.addresses.lToken),t.next=24;break;case 21:t.prev=21,t.t0=t.catch(0),console.log("Chain: _initializeContracts() error: "+t.t0);case 24:case"end":return t.stop()}},t,this,[[0,21]])}));return function(e){return t.apply(this,arguments)}}()},{key:"_initializeParameters",value:function(){var t=b()(p.a.mark(function t(){var e;return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this._call(this.pool,"symbol");case 3:return this.symbol=t.sent,t.next=6,this._call(this.bToken,"symbol");case 6:return this.bSymbol=t.sent,t.next=9,this._call(this.bToken,"decimals");case 9:return this.bDecimals=t.sent,t.next=12,this._call(this.pool,"getParameters");case 12:e=t.sent,this.multiplier=T(e.multiplier),this.feeRatio=T(e.feeRatio),this.minPoolMarginRatio=T(e.minPoolMarginRatio),this.minInitialMarginRatio=T(e.minInitialMarginRatio),this.minMaintenanceMarginRatio=T(e.minMaintenanceMarginRatio),this.minAddLiquidity=T(e.minAddLiquidity),this.redemptionFeeRatio=T(e.redemptionFeeRatio),this.fundingRateCoefficient=T(e.fundingRateCoefficient),this.minLiquidationReward=T(e.minLiquidationReward),this.maxLiquidationReward=T(e.maxLiquidationReward),this.liquidationCutRatio=T(e.liquidationCutRatio),this.priceDelayAllowance=C(e.priceDelayAllowance),t.next=30;break;case 27:t.prev=27,t.t0=t.catch(0),console.log("Chain: _initializeParameters() error: "+t.t0);case 30:case"end":return t.stop()}},t,this,[[0,27]])}));return function(){return t.apply(this,arguments)}}()}]),t}(),M=(new i.a,new S),j={name:"pools",data:function(){return{data:[],account:"",id:0,chanId:""}},methods:{connectwallet:function(){var t=this;M.connectWallet().then(function(e){console.log(e),e.success&&(t.account=e.account,M.initialize(0).then(function(e){M.tradeEvent(t.account).then(function(e){console.log(e),t.data=e.reverse(),t.data.map(function(t){t.volume=Math.abs(t.volume),t.time=r()(+t.time).format("YYYY-MM-DD HH:mm:ss")}),console.log(t.data)})}))})}},mounted:function(){this.connectwallet()}},O={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticStyle:{color:"#fff"},attrs:{id:"history"}},[n("div",{staticClass:"container-fluid ml-0"},[n("div",{staticClass:"row"},[n("div",{staticClass:"col-lg-12 ml-0 mt-5",staticStyle:{"overflow-y":"hidden"}},[n("div",{staticClass:"banner"},[n("div",{staticClass:"container-fluid"},[n("div",{staticClass:"row mt-2"},[n("table",{staticClass:"table table-hover table-dark table-border sidebar-bg"},[t._m(0),t._v(" "),n("tbody",t._l(t.data,function(e){return n("tr",{key:e.index,staticStyle:{height:"4.4rem"}},[n("td",{},[t._v(t._s(e.time))]),t._v(" "),n("td",{},[t._v(t._s(e.direction))]),t._v(" "),n("td",{},[t._v(t._s(e.baseToken))]),t._v(" "),n("td",{},[t._v(t._s(e.price))]),t._v(" "),n("td",{},[t._v(t._s(e.volume))]),t._v(" "),n("td",{},[t._v(t._s(e.notional))]),t._v(" "),n("td",{},[t._v(t._s(e.transactionFee))])])}),0)])])])])])])])])},staticRenderFns:[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("thead",{staticStyle:{"background-color":"#141924"}},[n("tr",{staticStyle:{height:"3.8rem","background-color":"#141924"}},[n("th",{staticClass:"text-left",attrs:{scope:"col"}},[t._v("Time")]),t._v(" "),n("th",{attrs:{scope:"col"}},[t._v("Direction")]),t._v(" "),n("th",{attrs:{scope:"col"}},[t._v("Base Token")]),t._v(" "),n("th",{attrs:{scope:"col"}},[t._v("Price")]),t._v(" "),n("th",{attrs:{scope:"col"}},[t._v("Volume")]),t._v(" "),n("th",{attrs:{scope:"col"}},[t._v("Notional")]),t._v(" "),n("th",{attrs:{scope:"col"}},[t._v("Transaction Fee")])])])}]};var P=n("C7Lr")(j,O,!1,function(t){n("hB4t")},"data-v-7fa5ca3c",null);e.default=P.exports},hB4t:function(t,e){}});